{% extends "base.html" %}
{% block title %}Fishing Predictor Pro - Dashboard{% endblock %}
{% block extra_css %}
<style>
body{background:linear-gradient(135deg,#0f172a 0%,#1e293b 100%);color:#f8fafc;min-height:100vh;padding:1rem}
.container{max-width:1400px;margin:0 auto;padding:0 1rem}
header{text-align:center;padding:1.5rem 0;margin-bottom:1.5rem;border-bottom:2px solid #334155;position:relative}
h1{font-size:2.5rem;background:linear-gradient(90deg,#3b82f6,#10b981);-webkit-background-clip:text;background-clip:text;color:transparent;margin-bottom:.5rem}
.subtitle{color:#94a3b8;font-size:1.1rem}

/* Structure √† 2 colonnes √©quilibr√©es */
.dashboard-grid{display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;margin-bottom:2rem}
@media (max-width:1024px){.dashboard-grid{grid-template-columns:1fr}}

.left-column,.right-column{display:flex;flex-direction:column;gap:1.5rem}

.card{background:rgba(30,41,59,.9);backdrop-filter:blur(10px);border-radius:16px;padding:1.5rem;border:1px solid #475569;box-shadow:0 10px 25px rgba(0,0,0,.3)}
.section-title{display:flex;align-items:center;gap:.75rem;font-size:1.5rem;font-weight:700;margin-bottom:1.5rem;color:#e2e8f0}
#map{width:100%;height:450px;border-radius:12px;overflow:hidden;position:relative}
.info-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:1rem;margin-top:1.5rem}
.score-display{text-align:center;padding:2rem;background:linear-gradient(135deg,rgba(30,41,59,.9),rgba(15,23,42,.9));border-radius:16px;margin:1rem 0;border:2px solid #475569}
.score-value{font-size:5rem;font-weight:900;background:linear-gradient(90deg,#10b981,#3b82f6);-webkit-background-clip:text;background-clip:text;color:transparent;line-height:1}
.btn{padding:.75rem 1.5rem;border-radius:8px;border:none;font-weight:600;cursor:pointer;transition:all .3s ease}
.btn-primary{background:linear-gradient(90deg,#3b82f6,#2563eb);color:white}
.btn-secondary{background:rgba(255,255,255,.1);color:white;border:1px solid #475569}
.btn-danger{background:#dc2626;color:white;border:none}
.btn-danger:hover{background:#b91c1c;transform:translateY(-2px);box-shadow:0 5px 15px rgba(220,38,38,0.3)}
.btn:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(0,0,0,.3)}

@media (max-width:768px){
    h1{font-size:1.8rem}
    .dashboard-grid{grid-template-columns:1fr;gap:1rem}
    #map{height:350px}
    .score-value{font-size:3.5rem}
    .info-grid{grid-template-columns:1fr 1fr}
}

@keyframes pulse{0%,100%{opacity:1}50%{opacity:.7}}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.5}}
@keyframes slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}
@keyframes slideOut{from{transform:translateX(0);opacity:1}to{transform:translateX(100%);opacity:0}}

.spot-card{transition:all .3s ease;cursor:pointer;border-radius:8px;overflow:hidden}
.spot-card:hover{transform:translateY(-4px);box-shadow:0 10px 25px rgba(0,0,0,.15);border-color:#3b82f6}
.status-indicator{display:inline-flex;align-items:center;gap:.5rem;padding:.5rem 1rem;border-radius:20px;font-weight:600;font-size:.9rem}
.status-good{background:#d1fae5;color:#065f46;border:2px solid #10b981}
.status-warning{background:#fef3c7;color:#92400e;border:2px solid #f59e0b}
.status-danger{background:#fee2e2;color:#991b1b;border:2px solid #ef4444;animation:pulse 2s infinite}

.spot-details-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:.75rem;margin-top:1rem}
.detail-item{text-align:center;padding:.75rem;background:rgba(51,65,85,.6);border-radius:8px;border:1px solid #475569}
.detail-icon{font-size:1.5rem;margin-bottom:.5rem}
.detail-value{font-size:1rem;font-weight:700;color:#f8fafc;margin-bottom:.25rem}
.detail-label{font-size:.75rem;color:#94a3b8}

/* Graphique */
.chart-container{position:relative;height:200px;margin:1rem 0}

/* M√©t√©o compacte */
.compact-weather-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem}
.weather-item{display:flex;flex-direction:column;align-items:center;padding:1rem;background:rgba(51,65,85,.6);border-radius:12px}
.weather-icon{font-size:2rem;margin-bottom:.5rem}
.weather-value{font-size:1.8rem;font-weight:700;color:#f8fafc;line-height:1}
.weather-label{font-size:.8rem;color:#94a3b8;margin-top:.25rem}

/* Score header compact */
.header-score{background:rgba(30,41,59,.95);border-radius:12px;padding:1rem 1.5rem;border:2px solid #475569;min-width:200px;text-align:center}
.header-score-value{font-size:2.5rem;font-weight:900;background:linear-gradient(90deg,#10b981,#3b82f6);-webkit-background-clip:text;background-clip:text;color:transparent;line-height:1}
.header-score-label{color:#94a3b8;font-size:.9rem}

/* D√©tails scientifiques */
.scientific-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:1rem;margin-top:1rem}
.scientific-item{text-align:center;padding:1rem;background:rgba(51,65,85,.6);border-radius:12px}
.scientific-icon{font-size:1.8rem}
.scientific-value{font-size:1.2rem;font-weight:700;margin:.5rem 0;color:#f8fafc}
.scientific-label{font-size:.75rem;color:#94a3b8}

/* Analyse d√©taill√©e */
.details-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem;margin-top:1.5rem}
.detail-card{padding:1rem;background:rgba(51,65,85,.6);border-radius:8px;border-left:4px solid #3b82f6}
.detail-card h4{margin:0 0 .5rem 0;color:#cbd5e1;font-size:.9rem;display:flex;align-items:center;gap:.5rem}
.detail-value-large{font-size:1.25rem;font-weight:700;color:#f8fafc}
.detail-value-small{font-size:.85rem;color:#94a3b8}

footer{text-align:center;padding:2rem 0;color:#94a3b8;border-top:1px solid #334155;margin-top:2rem}
</style>
{% endblock %}

{% block content %}
<div id="offshore-danger" style="display:none;position:fixed;top:0;left:0;right:0;background:#dc2626;color:white;padding:1rem;z-index:9999;text-align:center;animation:blink 1s infinite">
    <div style="display:flex;align-items:center;justify-content:center;gap:1rem">
        <i class="fas fa-skull-crossbones" style="font-size:1.5rem"></i>
        <div>
            <div style="font-weight:700;font-size:1.2rem">‚ö†Ô∏è DANGER VENT OFFSHORE</div>
            <div style="font-size:.9rem">NE P√äCHEZ PAS - Risque de noyade tr√®s √©lev√©</div>
        </div>
        <i class="fas fa-skull-crossbones" style="font-size:1.5rem"></i>
    </div>
</div>

<div class="container">
    <!-- Header compact -->
    <header>
        <div style="display:flex;justify-content:space-between;align-items:center;padding:0 1rem">
            <div>
                <h1><i class="fas fa-fish"></i> Fishing Predictor Pro</h1>
                <div class="subtitle">Dashboard temps r√©el ‚Ä¢ Tunisie</div>
            </div>
            <div class="header-score">
                <div class="header-score-value" id="header-prediction-score">--%</div>
                <div class="header-score-label" id="header-prediction-text">Chargement...</div>
            </div>
            <div style="display:flex;gap:1rem;align-items:center">
                <div class="status-indicator status-good" style="animation:pulse 2s infinite">
                    <i class="fas fa-satellite-dish"></i> R√âEL
                </div>
                <div style="background:rgba(0,0,0,.7);color:white;padding:.5rem 1rem;border-radius:20px;font-size:.8rem">
                    <i class="fas fa-hourglass-half"></i> <span id="countdown">30:00</span>
                </div>
            </div>
        </div>
    </header>

    <!-- Banni√®re d√©cision instantan√©e -->
    <div id="instant-decision-banner" style="margin-bottom:1.5rem"></div>

    <!-- Grille principale √† 2 colonnes √©quilibr√©es -->
    <div class="dashboard-grid">
        
        <!-- COLONNE GAUCHE -->
        <div class="left-column">
            
            <!-- Carte avec bouton effacer -->
            <div class="card">
                <div class="section-title">
                    <div style="width:40px;height:40px;background:linear-gradient(135deg,#3b82f6,#8b5cf6);border-radius:10px;display:flex;align-items:center;justify-content:center">
                        <i class="fas fa-map"></i>
                    </div>
                    Carte des spots
                    <div style="margin-left:auto;font-size:.8rem;color:#94a3b8">
                        <i class="fas fa-mouse-pointer"></i> Cliquez pour cr√©er
                    </div>
                </div>
                
                <div style="position:relative">
                    <!-- Filtres rapides -->
                    <div style="position:absolute;top:10px;right:15px;z-index:1000">
                        <div style="background:rgba(0,0,0,.8);backdrop-filter:blur(10px);padding:12px;border-radius:12px;border:1px solid #475569">
                            <div style="display:flex;gap:12px">
                                <label style="display:flex;align-items:center;gap:4px;cursor:pointer;color:white;font-size:12px">
                                    <input type="checkbox" checked onchange="window.FishingDashboard.toggleSpotType('port')">
                                    <i class="fas fa-anchor" style="color:#3b82f6"></i> Ports
                                </label>
                                <label style="display:flex;align-items:center;gap:4px;cursor:pointer;color:white;font-size:12px">
                                    <input type="checkbox" checked onchange="window.FishingDashboard.toggleSpotType('plage')">
                                    <i class="fas fa-umbrella-beach" style="color:#10b981"></i> Plages
                                </label>
                                <label style="display:flex;align-items:center;gap:4px;cursor:pointer;color:white;font-size:12px">
                                    <input type="checkbox" checked onchange="window.FishingDashboard.toggleSpotType('custom')">
                                    <i class="fas fa-map-pin" style="color:#ef4444"></i> Mes spots
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div id="map"></div>
                    <canvas id="wind-animation-canvas" style="position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:500;display:none"></canvas>
                </div>
                
                <div style="display:flex;justify-content:space-between;margin-top:1rem;flex-wrap:wrap;gap:.5rem">
                    <button id="windToggleBtn" onclick="window.FishingDashboard.toggleWindAnimation(event)" class="btn btn-secondary">
                        <i class="fas fa-wind"></i> Afficher vent
                    </button>
                    <button onclick="window.FishingDashboard.getCurrentLocation()" class="btn btn-secondary">
                        <i class="fas fa-location-dot"></i> Ma position
                    </button>
                    <button onclick="window.FishingDashboard.saveCurrentSpot()" class="btn btn-primary">
                        <i class="fas fa-save"></i> Sauvegarder
                    </button>
                    <button onclick="window.FishingDashboard.clearCustomSpots()" class="btn btn-danger">
                        <i class="fas fa-trash"></i> Effacer mes spots
                    </button>
                </div>
            </div>
            
            <!-- Score principal et v√©rification express -->
            <div class="card">
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:1.5rem;align-items:center">
                    <div class="score-display" style="margin:0">
                        <div class="score-value" id="prediction-score">--%</div>
                        <div id="prediction-text" style="font-size:1.1rem;margin-top:.5rem;color:#94a3b8">Chargement...</div>
                        <button onclick="window.FishingDashboard.quickCheck()" class="btn btn-primary" style="margin-top:1rem;width:100%">
                            <i class="fas fa-bolt"></i> V√©rification express
                        </button>
                    </div>
                    <div style="text-align:center">
                        <div style="font-size:4rem;background:linear-gradient(90deg,#3b82f6,#10b981);-webkit-background-clip:text;background-clip:text;color:transparent">
                            <i class="fas fa-fish"></i>
                        </div>
                        <div style="font-size:1.5rem;font-weight:700;color:#f8fafc" id="current-fish-count">--</div>
                        <div style="color:#94a3b8;font-size:.9rem">Poissons actifs estim√©s</div>
                    </div>
                </div>
            </div>
            
            <!-- Spot s√©lectionn√© + Distance -->
            <div class="card">
                <div class="section-title">
                    <div style="width:40px;height:40px;background:linear-gradient(135deg,#3b82f6,#8b5cf6);border-radius:10px;display:flex;align-items:center;justify-content:center">
                        <i class="fas fa-info-circle"></i>
                    </div>
                    Spot s√©lectionn√©
                </div>
                <div id="spot-info" style="padding:1rem;background:#1e293b;border-radius:8px;margin-bottom:1rem">
                    <div style="text-align:center;color:#94a3b8">
                        <i class="fas fa-map-marker-alt" style="font-size:2rem;margin-bottom:.5rem"></i>
                        <div>S√©lectionnez un spot sur la carte</div>
                    </div>
                </div>
                <div id="distance-info" style="margin-bottom:1rem"></div>
                <button onclick="window.FishingDashboard.calculatePreparationTime()" class="btn btn-secondary" style="width:100%">
                    <i class="fas fa-clock"></i> Temps de pr√©paration
                </button>
            </div>
            
            <!-- Donn√©es scientifiques compactes -->
            <div class="card">
                <div class="section-title">
                    <div style="width:40px;height:40px;background:linear-gradient(135deg,#3b82f6,#8b5cf6);border-radius:10px;display:flex;align-items:center;justify-content:center">
                        <i class="fas fa-flask"></i>
                    </div>
                    Donn√©es scientifiques
                </div>
                <div class="scientific-grid">
                    <div class="scientific-item">
                        <div class="scientific-icon">üå°Ô∏è</div>
                        <div class="scientific-value" id="water-temp">--¬∞C</div>
                        <div class="scientific-label">Eau</div>
                    </div>
                    <div class="scientific-item">
                        <div class="scientific-icon">üíß</div>
                        <div class="scientific-value" id="oxygen-level">-- mg/L</div>
                        <div class="scientific-label">Oxyg√®ne</div>
                    </div>
                    <div class="scientific-item">
                        <div class="scientific-icon">üåø</div>
                        <div class="scientific-value" id="phytoplankton">--</div>
                        <div class="scientific-label">Phytoplancton</div>
                    </div>
                    <div class="scientific-item">
                        <div class="scientific-icon">üåä</div>
                        <div class="scientific-value" id="wave-height">-- m</div>
                        <div class="scientific-label">Vagues</div>
                    </div>
                    <div class="scientific-item">
                        <div class="scientific-icon">üåô</div>
                        <div class="scientific-value" id="moon-phase">--</div>
                        <div class="scientific-label">Lune</div>
                    </div>
                    <div class="scientific-item">
                        <div class="scientific-icon">üé£</div>
                        <div class="scientific-value" id="best-period">--h</div>
                        <div class="scientific-label">Meilleur</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- COLONNE DROITE -->
        <div class="right-column">
            
            <!-- M√©t√©o compacte -->
            <div class="card">
                <div class="section-title">
                    <div style="width:40px;height:40px;background:linear-gradient(135deg,#3b82f6,#8b5cf6);border-radius:10px;display:flex;align-items:center;justify-content:center">
                        <i class="fas fa-cloud-sun"></i>
                    </div>
                    M√©t√©o actuelle
                </div>
                <div class="compact-weather-grid">
                    <div class="weather-item">
                        <div class="weather-icon"><i class="fas fa-wind"></i></div>
                        <div class="weather-value" id="wind-speed">--</div>
                        <div class="weather-label" id="wind-direction">Direction</div>
                    </div>
                    <div class="weather-item">
                        <div class="weather-icon"><i class="fas fa-temperature-half"></i></div>
                        <div class="weather-value" id="temperature">--¬∞C</div>
                        <div class="weather-label">Air</div>
                    </div>
                    <div class="weather-item">
                        <div class="weather-icon"><i class="fas fa-water"></i></div>
                        <div class="weather-value" id="pressure">-- hPa</div>
                        <div class="weather-label">Pression</div>
                    </div>
