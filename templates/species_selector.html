{% extends "base.html" %}
{% block title %}Fishing Predictor Pro - Guide des Esp√®ces Tunisiennes{% endblock %}
{% block extra_css %}
<style>.species-hero{background:linear-gradient(135deg,#10b981 0%,#059669 100%);color:#fff;padding:3rem 0;text-align:center;border-radius:0 0 20px 20px;margin-bottom:2rem}.species-container{max-width:1400px;margin:0 auto;padding:0 1.5rem}.season-indicator{display:inline-block;background:var(--success);color:#fff;padding:.5rem 1.5rem;border-radius:25px;margin-top:1rem;font-weight:600;box-shadow:0 4px 12px rgba(0,0,0,.1)}.filter-bar{background:#fff;padding:1.5rem;border-radius:20px;box-shadow:0 10px 30px rgba(0,0,0,.1);margin-bottom:2rem;display:flex;gap:1rem;flex-wrap:wrap;align-items:center;justify-content:center}.filter-group{display:flex;align-items:center;gap:.5rem}.filter-label{font-weight:600;color:var(--dark)}.filter-btn{padding:.6rem 1.2rem;border:2px solid var(--gray-light);background:#fff;border-radius:12px;cursor:pointer;font-weight:500;transition:all .3s ease;display:flex;align-items:center;gap:.5rem}.filter-btn:hover{border-color:var(--primary);transform:translateY(-2px)}.filter-btn.active{background:var(--primary);color:#fff;border-color:var(--primary)}.species-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:1.5rem;margin-bottom:3rem}.species-card{background:#fff;border-radius:20px;overflow:hidden;box-shadow:0 10px 30px rgba(0,0,0,.1);transition:all .3s ease;cursor:pointer;border:3px solid transparent}.species-card:hover{transform:translateY(-5px);box-shadow:0 15px 40px rgba(0,0,0,.15);border-color:var(--primary)}.species-card.recommended{border-color:var(--success);position:relative}.species-card.recommended::before{content:'RECOMMAND√â';position:absolute;top:1rem;right:1rem;background:var(--success);color:#fff;padding:.3rem .8rem;border-radius:15px;font-size:.8rem;font-weight:600;z-index:2}.card-header{padding:1.5rem;display:flex;align-items:center;gap:1rem;border-bottom:2px solid var(--gray-light)}.species-icon{font-size:2rem;width:70px;height:70px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff}.species-name{flex:1}.species-name h3{font-size:1.3rem;margin-bottom:.3rem}.scientific-name{font-size:.9rem;color:var(--gray);font-style:italic}.card-body{padding:1.5rem}.info-row{display:flex;justify-content:space-between;margin-bottom:.8rem;font-size:.9rem}.info-label{color:var(--gray);font-weight:500}.info-value{font-weight:600}.difficulty{display:inline-block;padding:.3rem .8rem;border-radius:15px;font-size:.8rem;font-weight:600}.difficulty.facile{background:#d1fae5;color:#065f46}.difficulty.moyenne{background:#fef3c7;color:#92400e}.difficulty.difficile{background:#fee2e2;color:#991b1b}.seasons-list{display:flex;gap:.5rem;flex-wrap:wrap;margin-top:1rem}.season-badge{padding:.3rem .8rem;background:var(--light);border-radius:15px;font-size:.8rem;font-weight:500}.season-badge.current{background:var(--success);color:#fff}.baits-list{display:flex;flex-wrap:wrap;gap:.5rem;margin-top:1rem}.bait-tag{padding:.3rem .6rem;background:#e0f2fe;border-radius:10px;font-size:.8rem;color:#0369a1}.card-footer{padding:1rem 1.5rem;background:var(--light);display:flex;justify-content:space-between;align-items:center}.select-btn{padding:.6rem 1.2rem;background:var(--primary);color:#fff;border:none;border-radius:12px;cursor:pointer;font-weight:600;transition:all .3s ease;display:flex;align-items:center;gap:.5rem}.select-btn:hover{background:var(--primary-dark);transform:translateY(-2px)}.seasonal-calendar{background:#fff;border-radius:20px;padding:2rem;box-shadow:0 10px 30px rgba(0,0,0,.1);margin-top:3rem}.calendar-header{text-align:center;margin-bottom:2rem}.calendar-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(200px,1fr));gap:1.5rem}.month-card{background:var(--light);border-radius:15px;padding:1.5rem;text-align:center}.month-card.current{background:var(--primary);color:#fff}.month-name{font-size:1.2rem;font-weight:600;margin-bottom:1rem}.month-species{display:flex;justify-content:center;gap:.5rem;flex-wrap:wrap}.month-icon{font-size:1.5rem}.loading{text-align:center;padding:3rem;grid-column:1/-1}.loading-spinner{width:50px;height:50px;border:5px solid #f3f3f3;border-top:5px solid var(--primary);border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 1rem}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}.empty-state{text-align:center;padding:3rem;color:var(--gray);grid-column:1/-1}.empty-state i{font-size:3rem;margin-bottom:1rem;opacity:.5}@media(max-width:768px){.species-grid{grid-template-columns:1fr}.filter-bar{flex-direction:column;align-items:stretch}.filter-group{justify-content:center}}</style>
{% endblock %}
{% block content %}
<div class="species-hero"><div class="species-container"><h1 style="font-size:2.5rem;margin-bottom:1rem"><i class="fas fa-fish"></i> Guide des Poissons Tunisiens</h1><p style="font-size:1.2rem;opacity:0.9">S√©lectionnez l'esp√®ce adapt√©e √† la saison et √† votre type de p√™che</p><div class="season-indicator" id="season-indicator"><i class="fas fa-calendar-alt"></i> Saison: <span id="current-season">--</span></div></div></div>
<div class="species-container">
<div class="filter-bar">
<div class="filter-group"><span class="filter-label">Cat√©gorie:</span><button class="filter-btn active" data-filter="all" aria-label="Toutes les cat√©gories"><i class="fas fa-layer-group"></i> Tous</button><button class="filter-btn" data-filter="surface" aria-label="Poissons de surface"><i class="fas fa-water"></i> Surface</button><button class="filter-btn" data-filter="fond" aria-label="Poissons de fond"><i class="fas fa-mountain"></i> Fond</button><button class="filter-btn" data-filter="large" aria-label="Poissons du large"><i class="fas fa-ship"></i> Large</button></div>
<div class="filter-group"><span class="filter-label">Difficult√©:</span><button class="filter-btn active" data-difficulty="all">Tous niveaux</button><button class="filter-btn" data-difficulty="facile"><i class="fas fa-star"></i> Facile</button><button class="filter-btn" data-difficulty="moyenne"><i class="fas fa-star"></i><i class="fas fa-star"></i> Moyenne</button><button class="filter-btn" data-difficulty="difficile"><i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i> Difficile</button></div>
<div class="filter-group"><span class="filter-label">Saison:</span><button class="filter-btn active" data-season="all">Toute l'ann√©e</button><button class="filter-btn" data-season="current"><i class="fas fa-check-circle"></i> Saison actuelle</button></div></div>
<div id="species-container" class="species-grid"></div>
<div class="seasonal-calendar"><div class="calendar-header"><h2><i class="fas fa-calendar"></i> Calendrier des Poissons par Mois</h2><p>D√©couvrez quels poissons sont les plus actifs chaque mois</p></div><div id="calendar-container" class="calendar-grid"></div></div>
<div id="loading" class="loading"><div class="loading-spinner"></div><p>Chargement des esp√®ces tunisiennes...</p></div></div>
{% endblock %}
{% block extra_js %}
<script>let allSpecies=[],recommendedSpecies=[],currentSeason='';async function loadSpeciesData(){document.getElementById('loading').style.display='block';try{const e=await fetch('/api/species_by_season'),t=await fetch('/api/all_species_complete');if(!e.ok||!t.ok)throw new Error('API non disponible');const n=await e.json(),o=await t.json();if("success"===n.status&&"success"===o.status){currentSeason=n.current_season,recommendedSpecies=n.recommended_species,document.getElementById('current-season').textContent=currentSeason,document.getElementById('season-indicator').style.background=getSeasonColor(currentSeason),allSpecies=o.species.map(e=>({...e,isRecommended:recommendedSpecies.some(t=>t.key===e.key)})),displaySpecies(allSpecies),loadSeasonalCalendar()}}catch(e){console.error('Erreur:',e),document.getElementById('species-container').innerHTML='<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><h3>Erreur de chargement</h3><p>Impossible de charger les donn√©es. Veuillez r√©essayer.</p><button class="btn btn-primary" onclick="loadSpeciesData()" style="margin-top:1rem"><i class="fas fa-redo"></i> R√©essayer</button></div>'}finally{document.getElementById('loading').style.display='none'}}function displaySpecies(e){const t=document.getElementById('species-container');if(0===e.length){t.innerHTML='<div class="empty-state"><i class="fas fa-search"></i><h3>Aucune esp√®ce trouv√©e</h3><p>Aucune esp√®ce ne correspond √† vos filtres.</p></div>';return}t.innerHTML=e.map(e=>`<div class="species-card ${e.isRecommended?'recommended':''}" data-category="${e.category}" data-difficulty="${e.difficulty}" data-seasons="${e.seasons.join(',')}"><div class="card-header"><div class="species-icon" style="background:${e.color}">${e.icon}</div><div class="species-name"><h3>${e.name}</h3><div class="scientific-name">${e.scientific}</div></div></div><div class="card-body"><div class="info-row"><span class="info-label">Cat√©gorie:</span><span class="info-value">${getCategoryLabel(e.category)}</span></div><div class="info-row"><span class="info-label">Difficult√©:</span><span class="difficulty ${e.difficulty}">${e.difficulty.toUpperCase()}</span></div><div class="info-row"><span class="info-label">Popularit√©:</span><span class="info-value">${'‚òÖ'.repeat(e.popularity)}</span></div><div class="seasons-list">${e.seasons.map(e=>`<span class="season-badge ${e===currentSeason?'current':''}">${getSeasonIcon(e)} ${e}</span>`).join('')}</div><div class="baits-list"><span style="font-size:0.9rem;color:#64748b;margin-right:0.5rem">App√¢ts:</span>${getSampleBaits(e.key).map(e=>`<span class="bait-tag">${e}</span>`).join('')}</div></div><div class="card-footer"><div>${e.isRecommended?'<span style="color:#10b981;font-weight:600"><i class="fas fa-check-circle"></i> Recommand√© cette saison</span>':'<span style="color:#64748b">Hors saison</span>'}</div><button class="select-btn" onclick="selectSpecies(\'${e.key}\')" aria-label="S√©lectionner ${e.name}"><i class="fas fa-check"></i> S√©lectionner</button></div></div>`).join('')}async function loadSeasonalCalendar(){try{const e=await fetch('/api/seasonal_calendar'),t=await e.json();"success"===t.status&&displayCalendar(t.calendar,t.current_month)}catch(e){console.error('Erreur calendrier:',e)}}function displayCalendar(e,t){const n=document.getElementById('calendar-container'),o=Object.keys(e).sort((e,t)=>e-t);n.innerHTML=o.map(n=>{const o=e[n],a=parseInt(n)===t;return`<div class="month-card ${a?'current':''}"><div class="month-name">${o.month_name}</div><div style="font-size:.9rem;color:${a?'#fff':'#64748b'};margin-bottom:1rem">${o.season}</div><div class="month-species">${o.species.slice(0,4).map(e=>`<div class="month-icon" title="${e.name}" style="color:${e.color}">${e.icon}</div>`).join('')}</div></div>`}).join('')}function setupFilters(){document.querySelectorAll('.filter-btn').forEach(e=>{e.addEventListener('click',function(){const e=this.parentElement.querySelector('.filter-label').textContent;if(e.includes('Cat√©gorie'))document.querySelectorAll('[data-filter]').forEach(e=>e.classList.remove('active'));else if(e.includes('Difficult√©'))document.querySelectorAll('[data-difficulty]').forEach(e=>e.classList.remove('active'));else if(e.includes('Saison'))document.querySelectorAll('[data-season]').forEach(e=>e.classList.remove('active'));this.classList.add('active'),applyFilters()})})}function applyFilters(){const e=document.querySelector('[data-filter].active').dataset.filter,t=document.querySelector('[data-difficulty].active').dataset.difficulty,n=document.querySelector('[data-season].active').dataset.season;let o=allSpecies;'all'!==e&&(o=o.filter(t=>t.category===e)),'all'!==t&&(o=o.filter(e=>e.difficulty===t)),'current'===n&&(o=o.filter(e=>e.isRecommended)),displaySpecies(o)}function selectSpecies(e){const t=allSpecies.find(t=>t.key===e);t&&(localStorage.setItem('selected_species',e),localStorage.setItem('selected_species_name',t.name),showNotification(`Esp√®ce s√©lectionn√©e: ${t.name}`,'success'),setTimeout(()=>{window.location.href='/'},1500))}function getSeasonColor(e){const t={printemps:'#10b981',√©t√©:'#f59e0b',automne:'#f97316',hiver:'#3b82f6'};return t[e]||'#3b82f6'}function getCategoryLabel(e){const t={surface:'Poisson de surface',fond:'Poisson de fond',large:'Poisson du large'};return t[e]||e}function getSeasonIcon(e){const t={printemps:'üå∏',√©t√©:'‚òÄÔ∏è',automne:'üçÇ',hiver:'‚ùÑÔ∏è'};return t[e]||'üìÖ'}function getSampleBaits(e){const t={loup:['Vers marins','Crevettes','Poissons-app√¢ts'],daurade:['Vers','Pain','Ma√Øs'],pageot:['Vers marins','Crevettes','Calamars'],maquereau:['Plumes','Leurres m√©talliques'],s√©riole:['Poissons vifs','Calamars'],marbr√©:['Vers','Crevettes','Coquillages'],mulet:['Pain','P√¢te','Vers'],rouget:['Vers','Crevettes','Poisson'],sar:['Vers','Crevettes','Crabe'],corbeau:['Crevettes','Vers','Poisson'],thon:['Poissons vivants','Calamars'],espadon:['Calamars','Poissons'],lichet:['Vers','Calamars','Petits poissons'],bonite:['Leurres','Poissons vifs','Calamars'],m√©rou:['Calamars','Poulpes','Crabes'],merlan:['Vers','Crevettes','App√¢ts artificiels'],merlu:['Vers','Crevettes','Petits poissons'],orphie:['Vers','Crevettes','App√¢ts artificiels']};return t[e]||['Vers','Crevettes']}function showNotification(e,t='info'){const n=document.createElement('div');n.className=`notification ${t}`,n.innerHTML=`<i class="fas fa-${'success'===t?'check-circle':'error'===t?'exclamation-circle':'info-circle'}"></i><span>${e}</span><button class="close-notification" onclick="this.parentElement.remove()">√ó</button>`,document.body.appendChild(n),setTimeout(()=>{n.parentElement&&n.remove()},3e3)}document.addEventListener('DOMContentLoaded',function(){loadSpeciesData(),setTimeout(setupFilters,1e3)});</script>
{% endblock %}